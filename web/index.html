<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Applictus</title>
    <link rel="icon" href="/public/Applictus_logo.png" type="image/png" />
    <link rel="stylesheet" href="/styles.css?v=2" />
  </head>
  <body>
    <div class="noise"></div>
    <header class="topbar hidden" id="topbar">
      <a class="brand" id="brand-link" href="#dashboard" aria-label="Applictus dashboard">
        <span class="logo-wrap brand-mark" aria-hidden="true">
          <span class="logo-fallback">A</span>
          <img
            src="/public/Applictus_logo.png"
            alt="Applictus logo"
            class="brand-logo"
            data-logo
          />
        </span>
        <div>
          <div class="brand-name">Applictus</div>
          <div class="brand-sub">Job Application Status Tracker</div>
        </div>
      </a>
      <nav class="nav" id="nav">
        <a href="#dashboard" class="nav-link">Dashboard</a>
        <a href="#archive" class="nav-link">Archive</a>
        <a href="#unsorted" class="nav-link">Unsorted Events</a>
      </nav>
      <div class="topbar-actions" id="session-actions">
        <button class="ghost" id="logout-btn" type="button">Log out</button>
        <a href="#account" class="avatar" id="account-avatar" aria-label="Account">
          <span class="avatar-mark" aria-hidden="true">
            <svg
              class="avatar-icon"
              xmlns="http://www.w3.org/2000/svg"
              width="96"
              height="96"
              viewBox="0 0 96 96"
              role="img"
              aria-label="Profile"
            >
              <circle cx="48" cy="48" r="46" fill="#ECECEC" />
              <circle cx="48" cy="34" r="18" fill="#BFC4C4" />
              <defs>
                <clipPath id="avatar-clip">
                  <circle cx="48" cy="48" r="46" />
                </clipPath>
              </defs>
              <g clip-path="url(#avatar-clip)">
                <circle cx="48" cy="78" r="30" fill="#BFC4C4" />
              </g>
            </svg>
          </span>
        </a>
      </div>
    </header>

    <main class="layout">
      <section class="card auth" id="auth-view">
        <div class="auth-brand">
          <span class="logo-wrap auth-logo" aria-hidden="true">
            <span class="logo-fallback">A</span>
            <img
              src="/public/Applictus_logo.png"
              alt="Applictus logo"
              class="auth-logo-image"
              data-logo
            />
          </span>
          <div>
            <div class="brand-name">Applictus</div>
            <div class="brand-sub">Job Application Status Tracker</div>
          </div>
        </div>
        <div class="auth-switch">
          <button class="ghost" data-auth="signin" type="button">Sign in</button>
          <button class="ghost" data-auth="signup" type="button">Create account</button>
        </div>
        <div class="auth-social">
          <button class="google-btn" id="google-auth" type="button">Continue with Google</button>
          <div class="auth-divider">or</div>
        </div>
        <div class="auth-panel" data-panel="signin">
          <h2>Welcome back</h2>
          <p class="muted">Sign in to your Applictus workspace.</p>
          <form id="login-form" class="form-grid">
            <label>
              Email
              <input type="email" name="email" required placeholder="you@domain.com" />
            </label>
            <label>
              Password
              <input type="password" name="password" required placeholder="Enter your password" />
            </label>
            <button type="submit">Sign in</button>
          </form>
        </div>
        <div class="auth-panel hidden" data-panel="signup">
          <h2>Create your workspace</h2>
          <p class="muted">We only store the metadata needed to track applications.</p>
          <form id="signup-form" class="form-grid">
            <label>
              Name
              <input type="text" name="name" placeholder="Jane Doe" />
            </label>
            <label>
              Email
              <input type="email" name="email" required placeholder="you@domain.com" />
            </label>
            <label>
              Password
              <input type="password" name="password" required placeholder="Minimum 12 characters" />
            </label>
            <button type="submit">Create account</button>
          </form>
        </div>
      </section>

      <section class="view" id="account-view" hidden>
        <div class="page-header">
          <h2>Account</h2>
          <p class="muted">Manage your workspace and connected services.</p>
        </div>
        <div class="account-grid">
          <div class="card">
            <h3>Signed in</h3>
            <div class="account-row">
              <div>
                <div class="muted small">Email</div>
                <div class="account-email" id="account-email">—</div>
                <div class="muted small">Auth methods</div>
                <div class="account-auth" id="account-auth">—</div>
              </div>
              <button class="ghost" id="account-logout" type="button">Log out</button>
            </div>
          </div>
          <div class="card">
            <h3>Gmail connection</h3>
            <div class="stack">
              <div class="gmail-panel">
                <button type="button" id="email-connect">Connect Gmail</button>
                <div class="pill" id="account-gmail-status">Not connected</div>
              </div>
              <div class="muted" id="account-gmail-email">—</div>
              <div class="callout hidden" id="gmail-hint">
                <div class="callout-title">Why is this disabled?</div>
                <div class="muted small" id="gmail-hint-text">Add Gmail OAuth env vars to enable.</div>
              </div>
              <div class="muted small">
                We only read job-related emails; we do not send email; we store minimal metadata.
              </div>
              <div class="sync-panel">
                <label>
                  Sync range (days)
                  <input type="number" id="account-sync-days" min="1" max="365" value="30" />
                </label>
                <button type="button" id="account-email-sync">Sync now</button>
                <div class="muted" id="account-sync-status">Idle</div>
              </div>
              <div class="muted small" id="account-sync-result"></div>
            </div>
          </div>
        </div>
      </section>

      <section class="dashboard" id="dashboard-view" hidden>
        <div class="dash-top">
          <div class="dash-header-row">
            <div class="dash-title">
              <h2>Dashboard</h2>
              <p class="muted small">Automatically track job applications and hiring signals from your inbox.</p>
            </div>
            <div class="dash-actions"></div>
          </div>
          <div class="sync-band">
            <div class="sync-strip" id="sync-strip">
              <button class="btn btn-secondary btn-md" type="button" data-action="manage-gmail">
                <span class="btn-icon-left" aria-hidden="true">✉</span>
                <span class="btn-label">Manage Gmail</span>
              </button>
              <div class="sync-strip-status">
                <div class="pill" id="dashboard-gmail-status">Not connected</div>
                <div class="muted small" id="dashboard-gmail-email">—</div>
                <span class="muted" id="sync-status">Ready</span>
              </div>
              <div class="sync-inline-controls">
                <div class="sync-strip-range" id="sync-controls">
                  <label for="sync-days">Sync range (days)</label>
                  <input type="number" id="sync-days" min="1" max="365" value="30" />
                </div>
                <button class="btn btn-primary btn-md" type="button" id="email-sync">
                  <span class="btn-icon-left" aria-hidden="true">⟳</span>
                  <span class="btn-label">Sync now</span>
                </button>
              </div>
              <div class="sync-connect-cta hidden" id="sync-connect-cta">
                <div class="muted small">Gmail not connected</div>
              </div>
            </div>
          <div class="sync-error hidden" id="sync-error-banner">
            <div class="sync-error-message" id="sync-error-message">Sync failed.</div>
            <button class="ghost icon" type="button" id="sync-error-toggle">Show details</button>
            <pre class="sync-error-detail hidden" id="sync-error-detail"></pre>
          </div>
          <div class="sync-progress hidden" id="sync-progress">
            <div class="sync-progress-meta">
              <span id="sync-progress-label">Syncing emails…</span>
              <span id="sync-progress-value">0%</span>
            </div>
            <div class="progress-track" aria-hidden="true">
              <div class="progress-fill" id="sync-progress-fill"></div>
            </div>
          </div>
          <div class="sync-summary" id="sync-summary">
            <div
              class="sync-summary-main clickable"
              role="button"
              tabindex="0"
              aria-expanded="false"
              aria-controls="sync-details-wrapper"
              id="sync-summary-main"
            >
              <span class="sync-summary-status" id="sync-summary-status">Last sync not run</span>
              <span class="sync-summary-metrics muted" id="sync-summary-metrics"></span>
              <span class="chevron" aria-hidden="true">▾</span>
            </div>
          </div>
          <div class="sync-details hidden" id="sync-details-wrapper">
            <pre class="sync-details-block" id="sync-result"></pre>
          </div>
          </div>
        </div>
        <section class="kpi-row" aria-label="Application stats">
          <div class="kpi-card status-total">
            <div class="kpi-meta">
              <span class="kpi-dot neutral"></span>
              <span class="kpi-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="4" y="5" width="16" height="3" rx="1"></rect>
                  <rect x="4" y="11" width="16" height="3" rx="1"></rect>
                  <rect x="4" y="17" width="10" height="3" rx="1"></rect>
                </svg>
              </span>
              <div class="kpi-label">Total tracked</div>
            </div>
            <div class="kpi-value" id="kpi-total">0</div>
          </div>
          <div class="kpi-card status-applied">
            <div class="kpi-meta">
              <span class="kpi-dot warning"></span>
              <span class="kpi-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="9"></circle>
                  <path d="M12 7v6l3 2"></path>
                </svg>
              </span>
              <div class="kpi-label">Applied</div>
            </div>
            <div class="kpi-value" id="kpi-applied">0</div>
          </div>
          <div class="kpi-card status-offer">
            <div class="kpi-meta">
              <span class="kpi-dot success"></span>
              <span class="kpi-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="12 2 15 8.5 22 9 17 13.8 18.5 20.8 12 17.4 5.5 20.8 7 13.8 2 9 9 8.5 12 2"></polygon>
                </svg>
              </span>
              <div class="kpi-label">Offer received</div>
            </div>
            <div class="kpi-value" id="kpi-offer">0</div>
          </div>
          <div class="kpi-card status-rejected">
            <div class="kpi-meta">
              <span class="kpi-dot danger"></span>
              <span class="kpi-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="9"></circle>
                  <path d="M15 9l-6 6"></path>
                  <path d="M9 9l6 6"></path>
                </svg>
              </span>
              <div class="kpi-label">Rejected</div>
            </div>
            <div class="kpi-value" id="kpi-rejected">0</div>
          </div>
        </section>
        <section class="card">
          <div class="card-header">
            <div class="header-left">
              <div>
                <h3>Applications</h3>
                <div class="muted" id="app-count">0 tracked</div>
              </div>
              <div class="header-actions">
                <div class="filter-inline" id="filters-inline">
                  <label>
                    Status
                    <select id="filter-status">
                      <option value="">Any status</option>
                      <option value="APPLIED">Applied</option>
                      <option value="UNDER_REVIEW">Under review</option>
                      <option value="INTERVIEW_REQUESTED">Interview requested</option>
                      <option value="INTERVIEW_COMPLETED">Interview completed</option>
                      <option value="OFFER_RECEIVED">Offer received</option>
                      <option value="REJECTED">Rejected</option>
                      <option value="GHOSTED">Ghosted</option>
                      <option value="UNKNOWN">Unknown</option>
                    </select>
                  </label>
                  <label class="filter-company-inline">
                    Company
                    <div class="input-with-clear">
                      <input type="text" id="filter-company" placeholder="Filter by company…" />
                      <button type="button" class="clear-input hidden" id="filter-company-clear" aria-label="Clear company filter">×</button>
                    </div>
                  </label>
                </div>
                <button class="icon-btn-circle" id="add-toggle" type="button" aria-label="Add application">+</button>
              </div>
            </div>
            <div class="header-right">
              <div class="view-toggle segmented" id="view-toggle">
                <button class="active" type="button" data-view="pipeline">Pipeline</button>
                <button type="button" data-view="table">Table</button>
              </div>
            </div>
          </div>
          <div class="pipeline-view" id="pipeline-view"></div>
          <div class="table" id="applications-table"></div>
          <div class="pagination" id="table-pagination">
            <button class="ghost" type="button" id="table-prev">Prev</button>
            <div class="muted" id="table-page-info">Page 1</div>
            <button class="ghost" type="button" id="table-next">Next</button>
          </div>
        </section>
      </section>

      <section class="view" id="archive-view" hidden>
        <div class="page-header">
          <h2>Archive</h2>
          <p class="muted">Archived applications stay here until restored.</p>
        </div>
        <div class="card">
          <div class="card-header">
            <div>
              <h3>Archived applications</h3>
              <div class="muted" id="archived-count">0 archived</div>
            </div>
          </div>
          <div class="table" id="archived-table"></div>
          <div class="pagination" id="archived-pagination">
            <button class="ghost" type="button" id="archived-prev">Prev</button>
            <div class="muted" id="archived-page-info">Page 1</div>
            <button class="ghost" type="button" id="archived-next">Next</button>
          </div>
        </div>
      </section>

      <section class="view" id="unsorted-view" hidden>
        <div class="page-header">
          <h2>Unsorted Events</h2>
          <p class="muted">Review and attach job-related emails.</p>
        </div>
        <div class="card">
          <div class="card-header">
            <div>
              <h3>Unsorted events</h3>
              <div class="muted">Review and attach job-related emails.</div>
            </div>
          </div>
          <div class="table" id="unsorted-table"></div>
        </div>
      </section>
    </main>

    <div class="drawer hidden" id="detail-drawer">
      <div class="drawer-backdrop" data-action="close"></div>
      <aside class="drawer-panel" id="detail-panel">
        <div class="drawer-header">
          <div class="drawer-header-text">
            <div class="drawer-title" id="detail-company">—</div>
            <div class="drawer-subtitle" id="detail-title">—</div>
          </div>
          <button class="drawer-close" type="button" data-action="close" aria-label="Close details">✕</button>
          <div class="drawer-chips">
            <div class="pill pill-status" id="detail-status">Unknown</div>
            <div class="pill subtle" id="detail-source">Inferred</div>
            <div class="pill subtle" id="detail-confidence">—</div>
          </div>
        </div>
        <div class="drawer-body">
          <div class="drawer-card">
            <div class="drawer-card-title">Details</div>
            <div class="details-grid" id="detail-meta"></div>
          </div>

          <div class="drawer-card">
            <div class="drawer-disclosure" id="detail-explainer-toggle" role="button" tabindex="0" aria-expanded="false" aria-controls="detail-explainer-body">
              <span>Status explanation</span>
              <span class="chevron">▾</span>
            </div>
            <div class="drawer-disclosure-body collapsed" id="detail-explainer-body">
              <div class="explanation" id="detail-explanation">No explanation yet.</div>
              <div class="suggestion-callout hidden" id="detail-suggestion">
                <div class="explanation" id="detail-suggestion-label">Suggestion</div>
                <div class="explanation" id="detail-suggestion-explanation">—</div>
                <div class="suggestion-actions">
                  <button class="ghost" type="button" data-action="accept-suggestion" id="detail-suggestion-accept">
                    Accept
                  </button>
                  <button class="ghost" type="button" data-action="dismiss-suggestion" id="detail-suggestion-dismiss">
                    Dismiss
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="drawer-card">
            <div class="drawer-card-title">Timeline</div>
            <div class="timeline" id="detail-timeline"></div>
          </div>
        </div>
        <div class="drawer-footer action-group" id="detail-actions">
          <button class="ghost" type="button" data-action="edit">Edit</button>
          <button class="ghost" type="button" data-action="archive">Archive</button>
          <button class="ghost danger" type="button" data-action="delete">Delete</button>
        </div>
      </aside>
    </div>

    <div class="modal hidden" id="modal-root" aria-hidden="true">
      <div class="modal-backdrop" data-action="backdrop"></div>
      <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <button class="ghost modal-close" type="button" data-action="close" aria-label="Close">
          x
        </button>
        <div class="modal-header">
          <h3 id="modal-title">Modal</h3>
          <p class="muted" id="modal-description"></p>
        </div>
        <div class="modal-body" id="modal-body"></div>
        <div class="modal-footer" id="modal-footer"></div>
      </div>
    </div>

    <script type="module" src="/app.js?v=2"></script>
  </body>
</html>
